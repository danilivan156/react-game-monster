import React, { useRef } from 'react'
import { Link } from 'react-router-dom'
import { useSelector } from 'react-redux'
import Currency from "../Common/Currency"
import Language from "../Common/Language"
import style from './Header.module.sass'
import { selectCart } from '../../redux/cart/selectors'

const Header: React.FC = () => {
    const [activeMenu, setActiveMenu] = React.useState(false)

    const navbar = [
        {
            title: "Товары",
            linkUrl: "/catalog"
        },
        {
            title: "Рулетка",
            linkUrl: {pathname: '/', hash: '#fortune'}
        },
        {
            title: "Новости",
            linkUrl: ""
        },
        {
            title: "О нас",
            linkUrl: "/"
        }
    ]
    const { items, totalPrice } = useSelector(selectCart)
    const totalCount = items.reduce((sum: number, item: any) => sum + item.count, 0)
    const isMounted = useRef(false)

    React.useEffect(() => {
        if(isMounted.current){
          const json = JSON.stringify(items)
          localStorage.setItem('cart', json)
        }
        isMounted.current = true
      }, [items])
    return (
        <header className="header">
            <div className="container">
                <div className="header__mobile-btn" >
                    <input type="checkbox" id="menu-bar" />
                    <label className="main-menu-btn-icon" htmlFor="menu-bar" onClick={()=>setActiveMenu(!activeMenu)}/> 
                </div>
                <Link to="/" className="header__logo">
                    <svg width="54" height="57" viewBox="0 0 54 57" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M29.9777 2.2704C19.4858 5.67502 18.6694 14.3308 19.7778 16.2216L27.3025 16.3404C24.6506 11.8464 26.2952 5.53607 29.9777 2.2704Z" fill="#DD0000" />
                    <path d="M32.828 4.67486C26.5465 7.9786 27.3446 14.879 28.2471 16.1527C30.1263 16.6003 32.6667 16.2788 33.702 16.0621C31.5442 13.0339 32.4558 7.1409 32.828 4.67486Z" fill="#3D0A66" />
                    <path d="M15.1527 43.159C19.4183 39.5028 23.6838 38.6955 26.8838 38.6061C30.0838 38.6955 34.3493 39.5028 38.6148 43.159C43.1767 47.0692 52.3005 51.6311 53.6039 39.9005C54.9073 28.17 48.3903 11.2258 35.3564 14.4843C32.5678 15.4137 28.8824 15.7218 26.8838 15.7778C24.8852 15.7218 21.1997 15.4137 18.4112 14.4843C5.37726 11.2258 -1.13971 28.17 0.163687 39.9005C1.46708 51.6311 10.5908 47.0692 15.1527 43.159Z" fill="white" />
                    <circle cx="14.0022" cy="28.5048" r="8.95723" fill="black" />
                    <path fillRule="evenodd" clipRule="evenodd" d="M11.2377 23.8964C10.7287 23.3874 9.90347 23.3874 9.39446 23.8964C8.88545 24.4054 8.88545 25.2307 9.39446 25.7397L12.1589 28.5042L9.39347 31.2696C8.88447 31.7786 8.88447 32.6039 9.39347 33.1129C9.90248 33.6219 10.7277 33.6219 11.2368 33.1129L14.0022 30.3474L16.7676 33.1128C17.2766 33.6218 18.1018 33.6218 18.6109 33.1128C19.1199 32.6038 19.1199 31.7785 18.6108 31.2695L15.8455 28.5042L18.6099 25.7398C19.1189 25.2308 19.1189 24.4055 18.6099 23.8965C18.1009 23.3875 17.2756 23.3875 16.7666 23.8965L14.0022 26.6609L11.2377 23.8964Z" fill="#DD0000" />
                    <circle cx="41.2481" cy="23.8181" r="2.4723" transform="rotate(15.884 41.2481 23.8181)" fill="#3D0A66" />
                    <circle cx="44.3028" cy="29.3067" r="2.4723" transform="rotate(15.884 44.3028 29.3067)" fill="#3D0A66" />
                    <circle cx="38.8145" cy="32.3612" r="2.4723" transform="rotate(15.884 38.8145 32.3612)" fill="#3D0A66" />
                    <circle cx="35.7598" cy="26.8727" r="2.4723" transform="rotate(15.884 35.7598 26.8727)" fill="#3D0A66" />
                    <path d="M19.836 56.2788C19.8376 53.0712 20.1106 51.9139 21.0484 49.1387C21.0484 49.1387 19.2358 48.5619 18.7334 48.3523C18.231 48.1427 16.4934 47.1207 16.4934 47.1207C16.3006 48.3225 15.7714 53.4864 19.836 56.2788Z" fill="#DD0000" />
                    <path d="M34.2492 56.1482C34.2476 52.9406 34.0219 51.588 33.0841 48.8128C33.0841 48.8128 34.6297 48.3057 35.2568 47.9922C35.8839 47.6786 37.4345 46.7806 37.4345 46.7806C37.6273 47.9824 38.3138 53.3558 34.2492 56.1482Z" fill="#DD0000" />
                    </svg>
                    <div className="header__logo-txt">Game Monster</div>
                </Link>
                <div className={activeMenu ? "header__mobile" : "header__middle"} >
                    <Language />
                    <div className="header__menu">
                        <nav className="navbar">
                            <ul>
                                {
                                    navbar.map(
                                        ( obj,index ) => 
                                            <li key={index}>
                                                <Link to={obj.linkUrl}>{obj.title}</Link>
                                            </li>
                                    )
                                }
                                <li>
                                    <Link className="header__menu-community" to="coming-soon.html">
                                        <svg width="33" height="24" viewBox="0 0 33 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M16.5 13.5456C21.3638 13.5456 25.4375 15.5346 25.4375 19.8184C25.4375 21.9542 24.1623 23.3032 22.4297 23.3032H10.5703C8.77203 23.3032 7.56252 22.3081 7.56252 20.1669C7.56252 15.6177 11.5831 13.5456 16.5 13.5456ZM6.57044 13.5463C7.09542 13.5659 7.52943 13.9876 7.56073 14.5301C7.59399 15.1065 7.16004 15.6011 6.59147 15.6348C3.92214 15.7931 2.0625 17.0197 2.0625 19.1214C2.0625 19.6441 2.29166 19.8184 2.75 19.8184H4.46875L4.56806 19.8232C5.09101 19.8738 5.49999 20.3204 5.49999 20.8638C5.49999 21.4412 5.03829 21.9093 4.46875 21.9093H2.75L2.61524 21.9066C1.18518 21.8504 0 20.8955 0 19.1214C0 15.6419 2.84987 13.7622 6.47102 13.5474L6.57044 13.5463ZM26.4296 13.5463L26.529 13.5474C30.1501 13.7622 33 15.6419 33 19.1214C33 20.8955 31.8148 21.8504 30.3848 21.9066L30.25 21.9093H28.5313C27.9617 21.9093 27.5 21.4412 27.5 20.8638C27.5 20.3204 27.909 19.8738 28.4319 19.8232L28.5313 19.8184H30.25C30.7083 19.8184 30.9375 19.6441 30.9375 19.1214C30.9375 17.0197 29.0779 15.7931 26.4085 15.6348C25.84 15.6011 25.406 15.1065 25.4393 14.5301C25.4706 13.9876 25.9046 13.5659 26.4296 13.5463ZM16.5 15.6366C12.5744 15.6366 9.62502 17.1566 9.62502 20.1669C9.62502 20.9694 9.79369 21.178 10.3886 21.2082L10.5703 21.2123H22.4297C23.0031 21.2123 23.375 20.8189 23.375 19.8184C23.375 17.1056 20.3661 15.6366 16.5 15.6366ZM8.24976 1.69716C8.39544 1.69716 8.54048 1.70375 8.68455 1.71687C9.25181 1.76851 9.67037 2.27656 9.61943 2.85164C9.56849 3.42671 9.06734 3.85104 8.50008 3.7994C8.41733 3.79187 8.33384 3.78807 8.24976 3.78807C6.73098 3.78807 5.49976 5.03625 5.49976 6.57595C5.49976 8.11565 6.73098 9.36383 8.24976 9.36383C8.41495 9.36383 8.57781 9.34918 8.73727 9.32034C8.8226 9.3049 8.90691 9.28541 8.98999 9.26194L9.09898 9.23562C9.61572 9.13972 10.1294 9.45624 10.2756 9.97905C10.431 10.5345 10.1128 11.1125 9.56484 11.2701L9.32294 11.3327L9.09957 11.3787C8.82066 11.4292 8.53656 11.4547 8.24976 11.4547C5.59189 11.4547 3.43726 9.27043 3.43726 6.57595C3.43726 3.88147 5.59189 1.69716 8.24976 1.69716ZM24.7525 1.69716C27.4104 1.69716 29.565 3.88147 29.565 6.57595C29.565 9.27043 27.4104 11.4547 24.7525 11.4547C24.4657 11.4547 24.1816 11.4292 23.9027 11.3787L23.6793 11.3327L23.4374 11.2701C22.8895 11.1125 22.5712 10.5345 22.7266 9.97905C22.8729 9.45624 23.3865 9.13972 23.9033 9.23562L24.0123 9.26194C24.0953 9.28541 24.1796 9.3049 24.265 9.32034C24.4244 9.34918 24.5873 9.36383 24.7525 9.36383C26.2713 9.36383 27.5025 8.11565 27.5025 6.57595C27.5025 5.03625 26.2713 3.78807 24.7525 3.78807C24.6684 3.78807 24.5849 3.79187 24.5022 3.7994C23.9349 3.85104 23.4338 3.42671 23.3828 2.85164C23.3319 2.27656 23.7504 1.76851 24.3177 1.71687C24.4618 1.70375 24.6068 1.69716 24.7525 1.69716ZM16.5 0.303223C19.5376 0.303223 22 2.79957 22 5.87898C22 8.95839 19.5376 11.4547 16.5 11.4547C13.4625 11.4547 11 8.95839 11 5.87898C11 2.79957 13.4625 0.303223 16.5 0.303223ZM16.5 2.39413C14.6015 2.39413 13.0625 3.95435 13.0625 5.87898C13.0625 7.80361 14.6015 9.36383 16.5 9.36383C18.3985 9.36383 19.9375 7.80361 19.9375 5.87898C19.9375 3.95435 18.3985 2.39413 16.5 2.39413Z" fill="#F59502" />
                                        </svg>Сообщество
                                    </Link>
                                </li>
                            </ul>
                        </nav>
                    </div>
                    {/*
                    <div className="header__search">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="7.66665" cy="8.08022" r="6.66665" stroke="#7C7C7C" strokeWidth="2" />
                            <path d="M12.7773 12.4983L17 16.6382" stroke="#7C7C7C" strokeWidth="2" strokeLinecap="round" />
                        </svg>
                        <input type="text" placeholder="Поиск" />
                    </div>
                    */}
                    <Currency />
                </div>
                {/*
                <div className="header__authorization flex">
                    <button className="header__sing" href="#">Вход</button>
                    <div className="header__separator">/</div>
                    <button className="header__out" href="#">Регистрация</button>
                </div>
                */}
                <div className={style.cart}>
                    <Link to="/cart">
                        <span>{totalPrice}₽</span>
                        <div className={style.delimiter}>/</div>
                        <svg
                            width="18"
                            height="18"
                            viewBox="0 0 18 18"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                d="M6.33333 16.3333C7.06971 16.3333 7.66667 15.7364 7.66667 15C7.66667 14.2636 7.06971 13.6667 6.33333 13.6667C5.59695 13.6667 5 14.2636 5 15C5 15.7364 5.59695 16.3333 6.33333 16.3333Z"
                                stroke="white"
                                strokeWidth="1.8"
                                strokeLinecap="round"
                                strokeLinejoin="round"
                            />
                            <path
                                d="M14.3333 16.3333C15.0697 16.3333 15.6667 15.7364 15.6667 15C15.6667 14.2636 15.0697 13.6667 14.3333 13.6667C13.597 13.6667 13 14.2636 13 15C13 15.7364 13.597 16.3333 14.3333 16.3333Z"
                                stroke="white"
                                strokeWidth="1.8"
                                strokeLinecap="round"
                                strokeLinejoin="round"
                            />
                            <path
                                d="M4.78002 4.99999H16.3334L15.2134 10.5933C15.1524 10.9003 14.9854 11.176 14.7417 11.3722C14.4979 11.5684 14.1929 11.6727 13.88 11.6667H6.83335C6.50781 11.6694 6.1925 11.553 5.94689 11.3393C5.70128 11.1256 5.54233 10.8295 5.50002 10.5067L4.48669 2.82666C4.44466 2.50615 4.28764 2.21182 4.04482 1.99844C3.80201 1.78505 3.48994 1.66715 3.16669 1.66666H1.66669"
                                stroke="white"
                                strokeWidth="1.8"
                                strokeLinecap="round"
                                strokeLinejoin="round"
                            />
                        </svg>
                        <span>{totalCount}</span>
                    </Link>
                </div>
            </div>
        </header>
    )
}

export default Header
